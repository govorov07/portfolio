<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–ó–∞–≥—Ä—É–∑–∫–∞...</title>
        <style>
            /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
            .loading-container {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                flex-direction: column;
                font-family: Arial, sans-serif;
            }
            .spinner {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #007bff;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .error {
                color: #d00;
                text-align: center;
                padding: 20px;
            }
        </style>
    </head>
    
    <body>
        <div id="app-loading" class="loading-container">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ...</p>
        </div>
        
        <div id="app-content" style="display: none;">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        </div>
        
        <script>
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const APP_CONFIG = {
                defaultPage: 'about_me',
                templatesPath: 'assets/templates/',
                dataPath: 'data/',
                pagesPath: 'data/pages/'
            };
            
            // –ú–∏–Ω–∏-–≤–µ—Ä—Å–∏—è PageBuilder –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            class InitialPageLoader {
                constructor() {
                    this.loadingElement = document.getElementById('app-loading');
                    this.contentElement = document.getElementById('app-content');
                }
                
                async loadDefaultPage() {
                    try {
                        console.log('üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é...');
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∂–∞—Ç—å
                        const urlParams = new URLSearchParams(window.location.search);
                        let pageId = urlParams.get('page');
                        
                        if (!pageId) {
                            // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –≤ URL, –∏—Å–ø–æ–ª—å–∑—É–µ–º about_me
                            pageId = APP_CONFIG.defaultPage;
                            // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                            window.history.replaceState({}, '', `?page=${pageId}`);
                        }
                        
                        console.log(`üìÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É: ${pageId}`);
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        const pageData = await this.loadPageData(pageId);
                    
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω—ã
                        await this.renderPage(pageData);
                    
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫
                        this.showContent();
                    
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                        this.showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
                    }
                }

                async loadPageData(pageId) {
                    const response = await fetch(`${APP_CONFIG.pagesPath}${pageId}.json`);
                    if (!response.ok) {
                        throw new Error(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageId} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (${response.status})`);
                    }
                    return await response.json();
                }

                async renderPage(pageData) {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                    const baseTemplateResponse = await fetch(`${APP_CONFIG.templatesPath}base.html`);
                    if (!baseTemplateResponse.ok) {
                        throw new Error('–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    let baseTemplate = await baseTemplateResponse.text();
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —à–∞–±–ª–æ–Ω
                    const contentTemplateResponse = await fetch(`${APP_CONFIG.templatesPath}content.html`);
                    let contentTemplate = contentTemplateResponse.ok ? await contentTemplateResponse.text() : '<div>–®–∞–±–ª–æ–Ω –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                    
                    // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
                    contentTemplate = this.renderSimpleTemplate(contentTemplate, pageData);
                    
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                    baseTemplate = baseTemplate.replace('{{content}}', contentTemplate);
                    baseTemplate = this.renderSimpleTemplate(baseTemplate, {
                        title: pageData.meta?.title || pageData.page?.title || '–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ'
                    });
                    
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM
                    this.contentElement.innerHTML = baseTemplate;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º CSS –∏ JS
                    await this.loadAssets();
                }

                renderSimpleTemplate(template, data) {
                    return template.replace(/\{\{(\w+)(\.\w+)*\}\}/g, (match, path) => {
                        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
                        const value = this.getNestedValue(data, path);
                        return value !== undefined ? value : '';
                    });
                }

                getNestedValue(obj, path) {
                    return path.split('.').reduce((current, key) => {
                        return current && current[key] !== undefined ? current[key] : '';
                    }, obj);
                }

                async loadAssets() {
                    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º CSS
                    const cssLinks = [
                        'assets/styles/combined.css',
                        'assets/styles/custom.css', 
                        'assets/styles/inline_styles.css'
                    ];

                    for (const cssLink of cssLinks) {
                        const link = document.createElement('link');
                        link.rel = 'stylesheet';
                        link.href = cssLink;
                        document.head.appendChild(link);
                    }

                    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º JS
                    const jsScripts = [
                        'assets/scripts/jquery-3.2.1.min.js',
                        'assets/scripts/split.min.js',
                        'assets/scripts/app.js'
                    ];

                    for (const jsScript of jsScripts) {
                        await new Promise((resolve) => {
                            const script = document.createElement('script');
                            script.src = jsScript;
                            script.onload = resolve;
                            script.onerror = resolve; // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                            document.head.appendChild(script);
                        });
                    }
                }

                showContent() {
                    this.loadingElement.style.display = 'none';
                    this.contentElement.style.display = 'block';
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Split.js –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    setTimeout(() => {
                        if (typeof Split !== 'undefined') {
                            Split(['#sidebar', '#content'], {
                                sizes: [15, 85],
                                minSize: 100,
                                gutterSize: 8
                            });
                        }
                    }, 100);
                }

                showError(message) {
                    this.loadingElement.innerHTML = `
                        <div class="error">
                            <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                            <p>${message}</p>
                            <button onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <br><br>
                            <a href="?page=about_me">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å about_me</a>
                        </div>
                    `;
                }
            }

            // üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('DOMContentLoaded', () => {
                const loader = new InitialPageLoader();
                loader.loadDefaultPage();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            window.addEventListener('error', (event) => {
                console.error('Global error:', event.error);
            });
        </script>
    </body>
</html>